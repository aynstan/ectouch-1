<!DOCTYPE html>
<html>
<head>
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" />
<meta name="apple-mobile-web-app-capable" content="yes" />
<meta name="apple-mobile-web-app-status-bar-style" content="black" />
<meta name="format-detection" content="telephone=no" />
<meta charset="utf-8">
<title>{$page_title}</title>



<link rel="stylesheet" href="__TPL__/assets/bootstrap/css/font-awesome.min.css">
<link rel="stylesheet" href="__TPL__/statics/css/swiper-3.2.5.min.css" />
<link rel="stylesheet" href="__TPL__/statics/css/ectouch.css?v=0005" />
<link rel="stylesheet" href="__TPL__/statics/fonts/iconfont.css" />
<link rel="stylesheet" href="__TPL__/statics/css/search.css" />

<style type="text/css">
html {
	font-size: 62.5%;
}
.com_box2{height: 77px; margin: 0 auto; clear:both}
.com_box2 dt{height: 37px; padding-top: 20px; text-align: center;}
.com_box2 dt a{background: url(themes/default/images/button.png) repeat-x 0 0; border: 1px solid #29aa0e; color: #fff; display: inline-block; font-size: 14px; height: 35px; line-height: 37px; margin: 0 auto; padding: 0 20px; text-align: center;}
.com_box2 dt a span{padding: 0 5px;}
</style>
</head>

<body style="max-width:640px;">
<div id="loading"><img src="__TPL__/statics/img/loading.gif" /></div>


<div class="con">
	<!-- #BeginLibraryItem "/library/new_search_small.lbi" --><!-- #EndLibraryItem -->
	<aside>
		<div class="menu-left scrollbar-none" id="sidebar"><h3 style="text-align:center; height:50px; line-height:50px">{$cat_name}</h3>
			<ul>
				{foreach from=$category item="vo" name="vo"}
				<li {if $smarty.foreach.vo.index == 0} class="active"{/if} rel="{$vo.cat_id}">{$vo.cat_name}{if $vo.use_price}</br>{$vo.category_price}/次{/if}</li>
				{/foreach}
			</ul>
		</div>
	</aside>


	<section class="menu-right-top product-sequence dis-box">
		<a class="box-flex a-change active" href="javascript:goodsSort(1)">综合</a>
		<a class="box-flex a-change" href="javascript:goodsSort(2)">销量</a>

	</section>

<section class="menu-right-goods padding-all j-content product-list j-product-list " data="2">

	<ul id="j-product-box">

<!-- #BeginLibraryItem "/library/ajaxgoodslist.lbi" --><!-- #EndLibraryItem -->

<!-- 		<%each list as vo%>
		<li>
			<div class="product-div">
				<a class="product-div-link" href="<%vo.url%>"></a>
				<img class="product-list-img" src="<%vo.goods_img%>" />
				<div class="product-text">
					<h4><%vo.goods_name%></h4>
					<p class="dis-box p-t-remark"><span class="box-flex"><%vo.goods_brief%></span>
				</div>
			</div>
		</li>
		<%/each%> -->
	</ul>
    <div class="clear"></div>
	<div id="loadingImg" style=" text-align:center">
		<img src="themes/default/images/loader.gif" alt="loading..." />
	</div>
	<div style=" margin-bottom:50px;">
		<dl class="com_box2" style=" margin-bottom:50px; display:none">
			<dt><a href="javascript:get_more()" id="more">加载更多商品</dt>
		</dl>
	</div>






</section>
</div>
<form>

    <input type="hidden" name="sort_by" id="sort_by" value="sort_order">
    <input type="hidden" name="cat_id" id="cat_id" value="{$id}">
    <input type="hidden" name="page" id="page" value="1">


</form>


<div class="search-div j-search-div ts-3">
	<section class="search">
		<form action="javascript:searchGoods()" method="post">
		<div class="text-all dis-box j-text-all">
			<div class="box-flex input-text">
				<input class="j-input-text" type="text" id="keywords" name="keywords" placeholder="{$lang.no_keywords}" />
				<i class="iconfont icon-guanbi is-null j-is-null"></i>
			</div>
			<button type="submit" class="btn-submit">搜索</button>
		</div>
		</form>
	</section>
	<section class="search-con">
		<div class="swiper-scroll history-search">
			<div class="swiper-wrapper">
			<div class="swiper-slide">
		<p>
			<label class="fl">{$lang.hot_search}</label>
		</p>
		<ul class="hot-search a-text-more">
			<!-- {foreach from=$hot_search_keywords item=keyword} -->
			<li class="w-3"><a href="javascript:searchGoods('{$keyword}')"><span>{$keyword}</span></a></li>
			<!-- {/foreach} -->
		</ul>
		<p class="hos-search">
			<label class="fl">最近搜索</label>
			<span class="fr" onclick="javascript:clearHistroy();"><i class="iconfont icon-xiao10"></i></span>
		</p>
		
			<ul class="hot-search a-text-more a-text-one" id="search_histroy">
				<!-- {foreach from=$search_histroy item=keyword} -->
				<li><a href="javascript:searchGoods('{$keyword}')"><span>{$keyword}</span></a></li>
				<!-- {/foreach} -->
			</ul>
			</div>
			</div>
			<div class="swiper-scrollbar"></div>
		</div>
	</section>
	<footer class="close-search j-close-search">
		点击关闭
	</footer>
</div>


<!-- #BeginLibraryItem "/library/new_page_footer.lbi" --><!-- #EndLibraryItem -->



<script type="text/javascript" src="__PUBLIC__/js/jquery.infinite.js"></script>
<script type="text/javascript" src="__PUBLIC__/js/template.js"></script>
<script type="text/javascript">
</script>
<script>

	$(function(){

	   // var url = '{:url('category/async_list', array('id'=>$this->_var['id'], 'type'=>$this->_var['type'], 'brand'=>$this->_var['brand'], 'price_min'=>$this->_var['price_min'], 'filter_attr'=>$this->_var['filter_attr'], 'page'=>$this->_var['page'], 'sort'=>$this->_var['sort'], 'order'=>$this->_var['order'], 'keywords'=>$this->_var['keywords']))}';
	   // $('.product-list').infinite({url: url,params:"brand={$brand}&price_min={$price_min}&price_max={$price_max}&filter_attr={$filter_attr}&keywords={$keywords}&type={$type}", template:'j-product'});
	   var cat_id = "{$id}";
		getAjaxGoods(cat_id,0);

		$('#sidebar ul li').click(function(){
			$(this).addClass('active').siblings('li').removeClass('active');
			var index = $(this).index();
			// $('.j-content').eq(index).show().siblings('.j-content').hide();

			var cat_id = $(this).attr('rel');
			$("#page").val(1);
			$("#search-name").val('');
			getAjaxGoods(cat_id);
		})
	})

	var stop=true; 


function searchGoods(keywords){
	debugger;
	var keywords = (typeof(keywords) == "undefined") ? document.getElementById('keywords').value : keywords;
	var cat_id = $("#cat_id").val();
	$("#page").val('1');
	$('#search-name').val(keywords);
	getAjaxGoods(cat_id,keywords);
	$('.j-close-search').trigger("click");
}

	function getAjaxGoods(cat_id,keywords,page){
	 	
	  	keywords   = (typeof(keywords) == "undefined") ? document.getElementById('search-name').value : keywords;
	  	page   = $("#page").val();
	  	sort_by   = $("#sort_by").val();

	  
	  	var param = "id="+cat_id+"&keywords="+keywords+"&page="+page+"&sort="+sort_by;  
	  	$.ajax({
			type:'get',
			url:'{:url("category/getAjaxGoods")}',
			dataType: "json",
			data:param,
			// beforeSend:function() {  
			    
			// },  
			// complete:function(result) {  
			// },  
			success:function(result){
				//$(".com_box2").remove();
				if(page == 1){
			   		$("#j-product-box").html(result.html);
				}else{
			   		$("#j-product-box").append(result.html);
				}
				var left_page = result.totalPage-page;
				if(left_page>0)
				{
					$("#page").val(++page);
					// $(".com_box2").show();
					stop = true;
				}else{
					stop = false;

				   $("#loadingImg").hide();
				}
				$("#cat_id").val(cat_id);

			}
		});
	}

	function goodsSort(type){
		if(type == '1'){
			$("#sort_by").val('sort_order');
			$(".box-flex").removeClass('active');
			$(".box-flex").eq(type).addClass('active');
		}else{
			$("#sort_by").val('sales_volume');
			$(".box-flex").removeClass('active');
			$(".box-flex").eq(type).addClass('active');
		}
			$("#page").val('1');
		get_more();
	}

	function get_more(){
		var cat_id = $("#cat_id").val();
		getAjaxGoods(cat_id);
	}

	$(window).scroll(function(){
	    totalheight = parseFloat($(window).height()) + parseFloat($(window).scrollTop()); 
	    if($(document).height() <= totalheight){ 
	        if(stop==true){ 
	            stop=false; 
	                get_more();
	        } 
	    } 
	});

function setCookie(cname, cvalue, exdays) {
    var d = new Date();
    d.setTime(d.getTime() + (exdays*24*60*60*1000));
    var expires = "expires="+d.toUTCString();
    document.cookie = cname + "=" + cvalue + "; " + expires;
}
function clearHistroy(){
	setCookie('ECS[keywords]', '', -1);
	document.getElementById("search_histroy").style.visibility = "hidden";
}

</script>
</body>

</html>







</body>
</html>